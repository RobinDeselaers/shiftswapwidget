<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Shift Overview Widget</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f6f7f8;
        padding: 20px;
    }

    .widget {
        width: 420px;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    h2 {
        margin-bottom: 10px;
    }

    .shift {
        border: 1px solid #ddd;
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    button {
        padding: 8px 12px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        background: #005eb8;
        color: white;
        transition: 0.2s;
    }

    button:hover {
        background: #00468a;
    }

    /* Calendar toggle */
    .calendar-toggle {
        margin: 10px 0;
        padding: 10px;
        background: #e8f0fe;
        border-radius: 8px;
        cursor: pointer;
    }

    .calendar {
        display: none;
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        background: #fafafa;
        border: 1px solid #ddd;
    }

    .calendar-day {
        padding: 8px;
        margin-bottom: 6px;
        border-left: 4px solid #005eb8;
        background: white;
        border-radius: 6px;
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
    }
    .modal-content {
        background: white;
        padding: 20px;
        width: 350px;
        border-radius: 10px;
    }
    .close {
        float: right;
        cursor: pointer;
        font-size: 20px;
    }
</style>
</head>
<body>

<div class="widget">
    <h2>Shift Overview</h2>

    <!-- Expandable Calendar View -->
    <div class="calendar-toggle" onclick="toggleCalendar()">
        ðŸ“… Show / Hide Calendar View
    </div>

    <div id="calendar" class="calendar">
        <div class="calendar-day"><strong>Mon 12</strong> â€” Morning Shift (07:00â€“15:00)</div>
        <div class="calendar-day"><strong>Tue 13</strong> â€” Evening Shift (15:00â€“23:00)</div>
        <div class="calendar-day"><strong>Wed 14</strong> â€” Night Shift (23:00â€“07:00)</div>
        <div class="calendar-day"><strong>Thu 15</strong> â€” Morning Shift (07:00â€“15:00)</div>
        <div class="calendar-day"><strong>Fri 16</strong> â€” Evening Shift (15:00â€“23:00)</div>
    </div>

    <hr style="margin: 20px 0;">

    <!-- Main Shift List -->
    <div class="shift">
        <div>
            <strong>Morning Shift</strong><br>
            07:00 â€“ 15:00
        </div>
        <button onclick="openSwapModal('Morning Shift')">Swap</button>
    </div>

    <div class="shift">
        <div>
            <strong>Evening Shift</strong><br>
            15:00 â€“ 23:00
        </div>
        <button onclick="openSwapModal('Evening Shift')">Swap</button>
    </div>

    <div class="shift">
        <div>
            <strong>Night Shift</strong><br>
            23:00 â€“ 07:00
        </div>
        <button onclick="openSwapModal('Night Shift')">Swap</button>
    </div>
</div>

<!-- Modal -->
<div id="swapModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeSwapModal()">&times;</span>
        <h3>Request Shift Swap</h3>
        <p id="selectedShift"></p>

        <label><strong>Swap with colleague:</strong></label><br><br>
        <select id="colleague" style="width:100%;padding:8px;border-radius:6px;">
            <option value="Dr. Smith">Dr. Smith</option>
            <option value="Dr. Perez">Dr. Perez</option>
            <option value="Dr. Lee">Dr. Lee</option>
        </select>

        <br><br>
        <button onclick="sendSwapRequest()">Send Request</button>
    </div>
</div>

<script>
let chosenShift = "";

// Toggle calendar expandable view
function toggleCalendar() {
    const cal = document.getElementById("calendar");
    cal.style.display = cal.style.display === "block" ? "none" : "block";
}

// Modal logic
function openSwapModal(shiftName) {
    chosenShift = shiftName;
    document.getElementById("selectedShift").innerHTML =
        "<strong>Shift:</strong> " + shiftName;

    document.getElementById("swapModal").style.display = "flex";
}

function closeSwapModal() {
    document.getElementById("swapModal").style.display = "none";
}

// API Call
async function sendSwapRequest() {
    const colleague = document.getElementById("colleague").value;

    const payload = {
        "accessorIds": ["6914bfac955bde56d791c4ee"],
        "channels": ["notificationCenter", "push"],
        "content": {
            "en_US": { "text": `New Shift Swap Requested: ${chosenShift} â†’ ${colleague}` },
            "de_DE": { "text": `New Shift Swap Requested: ${chosenShift} â†’ ${colleague}` }
        },
        "icon": {
            "en_US": { "type": "font", "char": "" },
            "de_DE": { "type": "font", "char": "" }
        },
        "image": {
            "en_US": {
                "type": "image",
                "href": "https://i.pinimg.com/474x/66/9b/d7/669bd7e734f2e0615d94fb1af77cc6aa.jpg",
                "width": 600,
                "height": 400
            },
            "de_DE": {
                "type": "image",
                "href": "https://i.pinimg.com/474x/66/9b/d7/669bd7e734f2e0615d94fb1af77cc6aa.jpg",
                "width": 600,
                "height": 400
            }
        },
        "link": "https://app.staffbase.com/content/page/6914e3ecd5cde774c74364f1"
    };

    try {
        const res = await fetch("https://app.staffbase.com/api/branch/notifications", {
            method: "POST",
            headers: {
                "Authorization": "Basic NjkxNGM3MzA0ZWE3Y2E1NmE2MDhjOGU2Ol0ta0t3KmU2b3phVG4zeG9SK2NoQVt7KnNeTHsmIXtrSSY5TCZze3AqeWssdDJELi1Rel1PYzJ7dGx0N0h+QjQ=",
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        if (res.ok) {
            alert("Shift swap request sent!");
        } else {
            alert("Error sending request. Check console.");
            console.error(await res.text());
        }

    } catch (err) {
        console.error(err);
        alert("Network error.");
    }

    closeSwapModal();
}
</script>

</body>
</html>
